<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FitTrack — Трекер привычек</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="main.css" />


  <style>
    .page-title {
      font-size: 1.75rem;
      font-weight: 600;
      margin: 2rem 0 2.5rem;
      position: relative;
    }

    .page-title::after {
      content: "";
      position: absolute;
      top: 50%;
      left: calc(100% + 1rem);
      width: 100%;
      height: 2px;
      background: #000;
      transform: translateY(-50%);
    }


    .btn-create {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1.75rem;
      font-size: 0.9rem;
      background: #c7a382;
      border: none;
      border-radius: 999px;
      color: #fff;
      font-weight: 500;
      cursor: pointer;
      margin-bottom: 2.5rem;
    }

    .btn-create span {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      font-size: 1rem;
      line-height: 20px;
      text-align: center;
    }


    .habit {
      margin-bottom: 3rem;
    }

    .habit__head {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      flex-wrap: wrap;
      margin-bottom: 1.25rem;
    }

    .chip {
      display: inline-block;
      padding: 0.35rem 1rem;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 700;
      color: #000;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .chip--yellow {
      background: #e7cc6a;
    }

    .chip--teal {
      background: #5da89e;
      color: #fff;
    }

    .habit__date {
      font-size: 0.85rem;
      color: #333;
      flex: 1;
    }

    .habit__status {
      padding: 0.35rem 1.25rem;
      border-radius: 999px;
      background: #c7c2a8;
      border: none;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
    }

    .habit__delete {
      padding: 0.35rem 1.25rem;
      border-radius: 999px;
      background: #c7a8a8;
      border: none;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
    }

    .habit--completed {
      opacity: 0.5;
    }


    .streak {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(32px, 1fr));
      gap: 0.4rem;
      max-width: 680px;
    }

    .dot {
      width: 32px;
      height: 32px;
      border: 3px solid #000;
      border-radius: 50%;
    }

    .dot--done {
      background: #5e7a45;
      border-color: #5e7a45;
    }

    .dot--missed {
      background: #c55a5a;
      border-color: #c55a5a;
    }


    @media (max-width: 480px) {
      .page-title {
        font-size: 1.5rem;
      }

      .streak {
        grid-template-columns: repeat(auto-fill, minmax(24px, 1fr));
      }

      .dot {
        width: 24px;
        height: 24px;
        border-width: 2px;
      }
    }
  </style>
</head>

<body>

  <header class="header">
    <div class="container header__inner">
      <a href="index.html" class="logo">FitTrack</a>

      <nav class="nav" id="navigation">
        <a class="nav__link" href="index.html">Главная</a>
        <a class="nav__link" href="nutrition.html">Питание</a>
        <a class="nav__link active" href="habits.html">Трекер&nbsp;привычек</a>
      </nav>

      <button class="burger" id="burger" aria-label="Открыть меню">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <main class="container">

    <h1 class="page-title">Формируем привычки</h1>
    <section class="habits">
      <button class="btn-create">
        СОЗДАТЬ ПРИВЫЧКУ <span>+</span>
      </button>

    </section>
    <div class="modal" id="habit-modal">
      <div class="modal__content">
        <span class="modal__close">&times;</span>
        <label>Привычка:
          <input type="text" id="habit-name" required>
        </label>
        <button class="btn" id="save-habit">Сохранить</button>
      </div>
    </div>
    <h2 style="font-size:1.1rem; margin:0 0 1.5rem;">Мои привычки</h2>

    <div id="habit-list">
      <!-- привычки -->
    </div>

    <section class="habit">
      <div class="habit__head">
        <span class="chip chip--yellow">Сон не менее 8&nbsp;часов</span>
        <span class="habit__date">Сегодня: 13.05 | День первый</span>
        <button class="habit__status">Выполнил(а)!</button>
        <button class="habit__delete">Удалить</button>
      </div>
      <div class="streak">

        <div class="dot dot--done"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
    </section>

    <section class="habit">
      <div class="habit__head">
        <span class="chip chip--teal">Утренняя гимнастика</span>
        <span class="habit__date">Сегодня: 13.05 | День десятый</span>
        <button class="habit__status">Выполнил(а)!</button>
        <button class="habit__delete">Удалить</button>
      </div>
      <div class="streak">

        <div class="dot dot--done"></div>
        <div class="dot dot--done"></div>
        <div class="dot dot--done"></div>
        <div class="dot dot--done"></div>
        <div class="dot dot--done"></div>
        <div class="dot dot--done"></div>
        <div class="dot dot--done"></div>
        <div class="dot dot--done"></div>

        <div class="dot dot--missed"></div>

        <div class="dot dot--done"></div>

        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
    </section>
  </main>


  <footer class="footer">
    <div class="container footer__inner">
      <span>Связаться с нами:</span>
      <a href="mailto:fittrack@gmail.com">fittrack@gmail.com</a>
      <a href="tel:+79999999999">+7 999 99 99 999</a>
    </div>
  </footer>


  <script>
    const burger = document.getElementById('burger');
    const nav = document.getElementById('navigation');
    burger.addEventListener('click', () => {
      burger.classList.toggle('burger--active');
      nav.classList.toggle('nav--open');
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const createButton = document.querySelector('.btn-create');
      const habitList = document.getElementById('habit-list');
      const modal = document.getElementById('habit-modal');
      const modalClose = document.querySelector('.modal__close');
      const saveHabitButton = document.getElementById('save-habit');
      const habitNameInput = document.getElementById('habit-name');

      const localStorageKey = 'habits';

      let habits = [];
      function formatDate(date) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        return `${day}.${month}`;
      }

      function saveHabitsToLocalStorage() {
        localStorage.setItem(localStorageKey, JSON.stringify(habits));
      }
      function loadHabitsFromLocalStorage() {
        const storedHabits = localStorage.getItem(localStorageKey);
        if (storedHabits) {
          habits = JSON.parse(storedHabits);
        }
      }

      function renderHabits() {
        habitList.innerHTML = '';
        habits.forEach((habit, index) => {
          const habitElement = document.createElement('section');
          habitElement.classList.add('habit');
          if (habit.isCompleted) {
            habitElement.classList.add('habit--completed');
          }
          const habitHead = document.createElement('div');
          habitHead.classList.add('habit__head');

          const chip = document.createElement('span');
          chip.classList.add('chip', 'chip--yellow');
          chip.textContent = habit.name;

          const habitDate = document.createElement('span');
          habitDate.classList.add('habit__date');
          habitDate.textContent = 'Сегодня: ' + formatDate(new Date()) + ' | День 0';
          const habitStatusButton = document.createElement('button');
          habitStatusButton.classList.add('habit__status');
          habitStatusButton.textContent = 'Выполнил(а)!';
          habitStatusButton.addEventListener('click', () => {
            habit.isCompleted = !habit.isCompleted;
            if (habit.isCompleted) {
              habitElement.classList.add('habit--completed');
            } else {
              habitElement.classList.remove('habit--completed');
            }
            saveHabitsToLocalStorage();
          });


          const deleteHabitButton = document.createElement('button');
          deleteHabitButton.classList.add('habit__delete');
          deleteHabitButton.textContent = 'Удалить';
          deleteHabitButton.addEventListener('click', () => {
            habits.splice(index, 1);
            saveHabitsToLocalStorage();
            renderHabits();
          });
          habitHead.appendChild(chip);
          habitHead.appendChild(habitDate);
          habitHead.appendChild(habitStatusButton);
          habitHead.appendChild(deleteHabitButton);
          const streak = document.createElement('div');
          streak.classList.add('streak');

          habit.progress = habit.progress || Array(31).fill(false);
          habit.missed = habit.missed || Array(31).fill(false);

          // точки для отслеживания прогресса
          for (let i = 0; i < 31; i++) {
            const dot = document.createElement('div');
            dot.classList.add('dot');
            dot.dataset.index = i;
            dot.dataset.completed = habit.progress[i] ? 'true' : 'false';

            if (habit.progress[i]) {
              dot.classList.add('dot--done');
              dot.classList.remove('dot--missed');
            } else if (habit.missed[i]) {
              dot.classList.add('dot--missed');
              dot.classList.remove('dot--done');
              dot.dataset.completed = 'missed';
            }

            // Если привычка выполнена, блокируем нажатие
            if (habit.isCompleted) {
              dot.style.pointerEvents = 'none';
            } else {
              dot.style.pointerEvents = 'auto';
            }

            dot.addEventListener('click', () => {
              habit.progress = habit.progress || Array(31).fill(false);
              habit.progress[i] = !habit.progress[i];

              dot.dataset.completed = habit.progress[i] ? 'true' : 'false';

              if (habit.progress[i]) {
                dot.classList.add('dot--done');
                dot.classList.remove('dot--missed');
                habit.missed[i] = false;
              } else {
                dot.classList.remove('dot--done');
                habit.missed[i] = false;
              }

              updateMissedDays(habit);
              saveHabitsToLocalStorage();
              renderHabits();
            });
            streak.appendChild(dot);
          }
          habitElement.appendChild(habitHead);
          habitElement.appendChild(streak);
          habitList.appendChild(habitElement);
        });
      }


      function updateMissedDays(habit) {
        const progress = habit.progress;
        const n = progress.length;

        habit.missed = habit.missed || Array(n).fill(false);
        const trueIndices = [];
        for (let i = 0; i < n; i++) {
          if (progress[i]) {
            trueIndices.push(i);
          }
        }

        // Если нет ни одного true
        if (trueIndices.length === 0) {
          for (let j = 0; j < n; j++) {
            habit.missed[j] = false;
          }
          return;
        }

        // Сначала считаем, что все не пропущены
        for (let j = 0; j < n; j++) {
          habit.missed[j] = false;
        }
        
        const firstTrueIndex = trueIndices[0];
        for (let i = 0; i < firstTrueIndex; i++) {
          if (!progress[i]) {
            habit.missed[i] = true;
          }
        }

        // Помечаем пропущенные между true
        for (let i = 0; i < trueIndices.length - 1; i++) {
          const startIndex = trueIndices[i];
          const endIndex = trueIndices[i + 1];

          for (let j = startIndex + 1; j < endIndex; j++) {
            if (!progress[j]) {
              habit.missed[j] = true;
            }
          }
        }

        if (trueIndices.length === 1) {
          const firstTrueIndex = trueIndices[0];
          for (let j = 0; j < firstTrueIndex; j++) {
            if (!progress[j]) {
              habit.missed[j] = true;
            }
          }
        }
      }

      // Открытие модального окна
      createButton.addEventListener('click', () => {
        modal.style.display = 'block';
      });

      // Закрытие модального окна
      modalClose.addEventListener('click', () => {
        modal.style.display = 'none';
      });

      // Сохранение привычки
      saveHabitButton.addEventListener('click', () => {
        const habitName = habitNameInput.value.trim();
        if (habitName !== '') {
          habits.push({ name: habitName, progress: Array(31).fill(false) });
          habitNameInput.value = '';
          modal.style.display = 'none';
          saveHabitsToLocalStorage();
          renderHabits();
        }
      });

      // Закрытие модального окна при клике вне его
      window.addEventListener('click', (event) => {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });

      loadHabitsFromLocalStorage();
      renderHabits();
    });
  </script>
</body>

</html>